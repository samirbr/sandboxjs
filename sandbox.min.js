var SANDBOX=(function(f){f(document).ajaxError(function(){console.log(arguments[3].stack)});function g(h){h=h.toLowerCase().replace("-","_");if(h.length>3){h=h.substring(0,3)+h.substring(3).toUpperCase()}return h}function d(h){if(b.hasOwnProperty(h)){return b[h]}else{return false}}var e;var c=false;var b={};var a=function(j,h,i){this.title=j;this.path=i||"";this.current=null;this.menu=[];this.routing={};this.params={};this.culture=g(h||navigator.language||navigator.userLanguage);document.title=j;e=this};a.prototype={load:function(h,i){i=i||function(){};f.getJSON(h,function(j){e.putAll(j);e.render();i(f("#container").get(0),this.params)})},putAll:function(h){h.forEach(function(i){if(i.constructor!==SANDBOX.Page){i=new SANDBOX.Page(i)}e.put(i)})},put:function(j){this.menu.push(j);this.routing[j.route]=j;if(j.hasOwnProperty("pages")){for(var h in j.pages){var k=j.pages[h];this.routing[k.route]=k}}},forward:function(h){if(typeof h=="number"){var i={403:"Forbidden",404:"Not Found"};var j=[];j.push('<div id="container">');j.push("<br /><br /><br />");j.push("<h1>"+h+" "+i[h]+"</h1>");j.push('<img src="assets/img/'+h+'.jpg" />');j.push("<div>");document.title=this.title+" :: "+h+" "+i[h];f(document.body).html(j.join("\n"));f("#container").css({"text-align":"center",width:"100%"});f("#container *").css("margin","0 auto")}else{window.location=h}},route:function(){var h=window.location.pathname.replace(new RegExp(SANDBOX.escape(this.path)),"");if(this.routing.hasOwnProperty(h)){this.current=this.routing[h]}else{Object.keys(this.routing).forEach(function(i){var k,j;if(k=i.match(/\{([^\{\}\/]+)\}/gi)){if(j=h.match(new RegExp(i.replace(/\{([^\{\}\/]+)\}/gi,"([^\\/]+)"),"i"))){j.shift();if(j.length){e.current=e.routing[i];e.params=SANDBOX.combine(k,j);return false}}}})}return this.current},trans:function(){if(!c){f.getJSON("/i18n/"+this.culture+".json",function(h){c=true;b=h.translations;f("[data-trans]").each(function(){var i=f(this).attr("data-trans");var j;if(j=d(i)){f(this).text(j)}})})}},render:function(){if(this.route()){var n=[];n.push("<header>");n.push('<div class="navbar">');n.push('<div class="navbar-inner">');n.push('<div class="container">');n.push('<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">');n.push('<span class="icon-bar"></span>');n.push('<span class="icon-bar"></span>');n.push('<span class="icon-bar"></span>');n.push("</a>");n.push('<a class="brand" href="/">'+this.title+"</a>");n.push('<div class="nav-collapse">');n.push('<ul class="nav">');for(var l in this.menu){if(this.menu[l].hasOwnProperty("pages")){n.push('<li class="dropdown">');n.push('<a href="#" class="dropdown-toggle" data-toggle="dropdown">');n.push(this.menu[l].name+' <b class="caret"></b>');n.push("</a>");n.push('<ul class="dropdown-menu">');for(var k in this.menu[l].pages){var m=this.menu[l].pages[k];n.push('<li><a href="'+this.path+m.route+'">'+m.name+"</a></li>")}n.push("</ul>");n.push("</li>")}else{n.push('<li><a href="'+this.path+this.menu[l].route+'">'+this.menu[l].name+"</a></li>")}}n.push("</ul>");n.push("</div>");n.push("</div>");n.push("</div>");n.push("</div>");n.push("</header>");n.push('<div id="container" class="span12">');n.push("<div>");f(document.body).append(n.join("\n"));f("#container").height(f(window).height()-f("header").height()-50);f('a[href="'+this.current.route+'"]').parent("li").addClass("active");document.title=this.title+" :: "+this.current.name;if(typeof this.current.content==="object"){if(this.current.content.hasOwnProperty("src")){var h=SANDBOX.replace(this.current.content.src,this.params);f("#container").load(h,function(j,i,o){if(i=="error"){e.forward(403)}})}else{if(this.current.content.hasOwnProperty("onReady")&&typeof this.current.content.onReady==="function"){this.current.content.onReady(f("#container").get(0),this.params)}}}else{f("#container").append(SANDBOX.replace(this.current.content,this.params))}}else{this.forward(404)}this.trans()}};return a})(jQuery);SANDBOX.Page=(function(){var a=function(b){this.name="";this.route="/";this.content="";for(var c in b){this[c]=b[c]}};return a})();SANDBOX.combine=function(c,a){var d={};for(var b=0;b<c.length;b++){d[c[b]]=a[b]}return d};SANDBOX.escape=function(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")};SANDBOX.replace=function(c,b){if(Object.keys(b).length){for(var a in b){c=c.replace(new RegExp(SANDBOX.escape(a),"g"),(decodeURIComponent(b[a])).replace(/(\+)/," "))}}return c};SANDBOX.DWR={};SANDBOX.DWR.url="/dwr";SANDBOX.DWR.ajax=function(a,c,b){return $.parseJSON($.ajax({url:SANDBOX.DWR.URL,type:"post",dataType:"json",data:{entity:a,method:c,params:b},async:false}).responseText)};